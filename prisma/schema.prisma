generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String                @id @default(cuid())
  clerkId              String                @unique
  email                String                @unique
  firstName            String?
  lastName             String?
  imageUrl             String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  availability         String                @default("sporadic")
  bio                  String?
  contributorScore     Float                 @default(0.0)
  experienceLevel      String                @default("intermediate")
  followersCount       Int                   @default(0)
  followingCount       Int                   @default(0)
  githubUsername       String?               @unique
  isAvailableForHire   Boolean               @default(false)
  isMentor             Boolean               @default(false)
  lastGitHubSync       DateTime?
  linkedinUrl          String?
  location             String?
  openSourceExperience Int                   @default(0)
  publicReposCount     Int                   @default(0)
  totalContributions   Int                   @default(0)
  totalStarsReceived   Int                   @default(0)
  twitterUsername      String?
  website              String?
  aiAnalyses           AiAnalysis[]
  contributions        Contribution[]
  contributorPortfolio ContributorPortfolio?
  impactAnalyses       ImpactAnalysis[]
  learningGoals        LearningGoal[]
  repositoryAnalyses   RepositoryAnalysis[]
  savedRepos           SavedRepository[]
  technicalSkills      TechnicalSkill[]
  interactions         UserInteraction[]
  preferences          UserPreference[]
  userPreferences      UserPreferences?
  userProfile          UserProfile?

  @@map("users")
}

model UserProfile {
  id                  String   @id @default(cuid())
  userId              String   @unique
  skillLevel          String   @default("beginner")
  interests           String[]
  goals               String[]
  experience          Json?
  learnedWeights      Json?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  avoidedTech         String[]
  communicationStyle  String   @default("collaborative")
  learningStyle       String   @default("hands-on")
  preferredDifficulty String   @default("medium")
  preferredTech       String[]
  timeCommitment      String   @default("5hrs")
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model UserPreferences {
  id              String   @id @default(cuid())
  userId          String   @unique
  techStack       String[]
  goal            String   @default("learn")
  experienceLevel String   @default("beginner")
  completed       Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_onboarding_preferences")
}

model Repository {
  id           String            @id @default(cuid())
  fullName     String            @unique
  name         String
  owner        String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  aiAnalyses   AiAnalysis[]
  savedRepos   SavedRepository[]
  interactions UserInteraction[]

  @@map("repositories")
}

model UserInteraction {
  id                 String     @id @default(cuid())
  userId             String
  repositoryFullName String
  type               String
  score              Int?
  metadata           Json?
  timestamp          DateTime   @default(now())
  duration_ms        Int?
  session_id         String?
  source_page        String?
  repository         Repository @relation(fields: [repositoryFullName], references: [fullName], onDelete: Cascade)
  user               User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_interactions")
}

model UserPreference {
  id        String   @id @default(cuid())
  userId    String
  category  String
  key       String
  value     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category, key])
  @@map("user_ml_preferences")
}

model SavedRepository {
  id           String     @id @default(cuid())
  userId       String
  repoFullName String
  repoName     String
  repoUrl      String
  description  String?
  language     String?
  stars        Int        @default(0)
  tags         String[]
  notes        String?
  savedAt      DateTime   @default(now())
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  repository   Repository @relation(fields: [repoFullName], references: [fullName], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, repoFullName])
  @@map("saved_repositories")
}

model AiAnalysis {
  id                 String     @id @default(cuid())
  userId             String?
  repositoryFullName String
  analysisType       String
  content            Json
  metadata           Json?
  createdAt          DateTime   @default(now())
  expiresAt          DateTime?
  repository         Repository @relation(fields: [repositoryFullName], references: [fullName], onDelete: Cascade)
  user               User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("ai_analyses")
}

model RepositoryAnalysis {
  id               String   @id @default(cuid())
  userId           String
  repoFullName     String
  repoUrl          String
  flowchartMermaid String
  explanation      Json
  resources        Json
  insights         Json?
  analysisVersion  String   @default("1.0")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, repoFullName])
  @@map("repository_analyses")
}

model CommunityStats {
  id                      String   @id @default(cuid())
  totalQueries            Int      @default(0)
  totalUsers              Int      @default(0)
  activeRepositories      Int      @default(0)
  successfulContributions Int      @default(0)
  averageSatisfaction     Float    @default(0.0)
  date                    DateTime @default(now())
  createdAt               DateTime @default(now())

  @@map("community_stats")
}

model PopularRepository {
  id                 String   @id @default(cuid())
  fullName           String   @unique
  name               String
  description        String?
  language           String?
  stars              Int      @default(0)
  forks              Int      @default(0)
  openIssues         Int      @default(0)
  topics             String[]
  competitionLevel   String   @default("moderate")
  activityLevel      String   @default("moderate")
  aiDomain           String   @default("other")
  difficultyLevel    String   @default("intermediate")
  difficultyScore    Float    @default(50.0)
  contributorCount   Int      @default(0)
  recentCommits      Int      @default(0)
  issueResponseRate  Float    @default(50.0)
  documentationScore Float    @default(50.0)
  lastFetched        DateTime @default(now())
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@map("popular_repositories")
}

model RecommendationCache {
  id           String   @id @default(cuid())
  userId       String?
  cacheKey     String   @unique
  repositories Json
  metadata     Json?
  createdAt    DateTime @default(now())
  expiresAt    DateTime

  @@map("recommendation_cache")
}

model RepositoryReference {
  id          String   @id @default(cuid())
  fullName    String   @unique
  name        String
  owner       String
  description String?
  language    String?
  stars       Int      @default(0)
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("repository_references")
}

model TechnicalSkill {
  id                String    @id @default(cuid())
  userId            String
  skillName         String
  category          String
  proficiency       Float
  yearsOfExperience Int       @default(0)
  lastUsed          DateTime?
  isPreferred       Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, skillName])
  @@map("technical_skills")
}

model LearningGoal {
  id          String    @id @default(cuid())
  userId      String
  skillName   String
  category    String
  targetLevel Float
  priority    String    @default("medium")
  deadline    DateTime?
  status      String    @default("active")
  progress    Float     @default(0.0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("learning_goals")
}

model Contribution {
  id               String    @id @default(cuid())
  userId           String
  repoFullName     String
  contributionType String
  title            String
  description      String?
  prNumber         Int?
  issueNumber      Int?
  status           String
  estimatedTime    String?
  actualTime       String?
  skillsUsed       String[]
  skillsLearned    String[]
  impactScore      Float
  visibilityBoost  Float
  learningValue    Float
  networkingValue  Float
  mentorshipValue  Float
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  completedAt      DateTime?
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("contributions")
}

model ContributorPortfolio {
  id                  String   @id @default(cuid())
  userId              String   @unique
  totalContributions  Int      @default(0)
  totalRepositories   Int      @default(0)
  totalStarsReceived  Int      @default(0)
  totalIssuesClosed   Int      @default(0)
  totalPRsMerged      Int      @default(0)
  averageImpactScore  Float    @default(0.0)
  topSkills           String[]
  favoriteLanguages   String[]
  contributionsByType Json
  skillsAcquired      String[]
  testimonials        Json
  impactMetrics       Json
  achievements        String[]
  portfolioUrl        String?
  resumeUrl           String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("contributor_portfolios")
}

model ImpactAnalysis {
  id                  String   @id @default(cuid())
  userId              String
  repoFullName        String
  contributionId      String
  visibilityBoost     Float
  learningValue       Float
  networkingValue     Float
  careerAdvancement   Float
  communityImpact     Float
  technicalImpact     Float
  documentationImpact Float
  overallScore        Float
  analysisDate        DateTime @default(now())
  createdAt           DateTime @default(now())
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("impact_analyses")
}

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("system_config")
}
